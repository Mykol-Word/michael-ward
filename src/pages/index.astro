---
import '../styles/global.css';
import projectsData from '../data/projects.json';
import experienceData from '../data/experience.json';

const colorClasses = {
	blue: "border-blue-500",
	purple: "border-purple-500",
	green: "border-green-500",
	orange: "border-orange-500",
	pink: "border-pink-500",
};
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/png" href={`${import.meta.env.BASE_URL}/images/coin.png`} />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Michael Ward</title>
		<script is:inline define:vars={{ basePath: import.meta.env.BASE_URL }}>
			window.BASE_URL = basePath;
		</script>
	</head>
	<body class="min-h-screen relative" style="background: repeating-linear-gradient(45deg, #2d5016, #2d5016 10px, #3a6b1e 10px, #3a6b1e 20px);">
		<div id="score-display" class="fixed top-4 right-4 z-50 retro-score">
			Gold: <span id="score">0</span>
		</div>

		<div id="shop-display" class="fixed top-24 right-4 z-50 retro-shop">
			<div class="shop-item" id="purple-item">
				<button id="purple-btn" class="shop-button" data-cost="15" title="Purple is my favorite color!">
					<span class="shop-name">Purple BG</span>
					<span class="shop-cost">15 Gold</span>
				</button>
				<button id="purple-toggle" class="toggle-button" style="display: none;" title="Toggle purple background">Toggle</button>
			</div>
			<div class="shop-item" id="evil-item">
				<button id="evil-btn" class="shop-button" data-cost="40" title="Turn the site evil - inverted colors, dark theme">
					<span class="shop-name">Evil Mode</span>
					<span class="shop-cost">40 Gold</span>
				</button>
				<button id="evil-toggle" class="toggle-button" style="display: none;" title="Toggle evil mode">Toggle</button>
			</div>
			<div class="shop-item" id="newcoin-item">
				<button id="newcoin-btn" class="shop-button" data-cost="50" title="Replace coin with a new image">
					<span class="shop-name">New Coin</span>
					<span class="shop-cost">50 Gold</span>
				</button>
				<button id="newcoin-toggle" class="toggle-button" style="display: none;" title="Toggle new coin">Toggle</button>
			</div>
		</div>

		<div class="responsive-container mx-auto px-4 sm:px-6 py-6 sm:py-12 relative z-10">
			<!-- Profile Section -->
			<div class="retro-panel mb-8">
				<div class="retro-title-bar">
					<span class="retro-title-text">Profile</span>
				</div>
				<div class="retro-content">
					<div class="flex flex-col sm:flex-row items-center sm:items-start gap-6">
						<!-- Profile Picture -->
						<div class="flex-shrink-0">
							<div class="retro-avatar">
								<div class="retro-avatar-inner">
									<img src={`${import.meta.env.BASE_URL}/images/headshot.jpg`} alt="Profile photo" />
								</div>
							</div>
						</div>

						<!-- Name and Description -->
						<div class="flex-1 w-full">
							<h1 class="retro-wordart mb-4">Michael Ward</h1>
							<div class="space-y-2">
								<div class="retro-stat-box">
									<span class="retro-label">School:</span>
									<span class="retro-value">UCLA - B.S. Computer Science & Engineering and Philosophy</span>
								</div>
								<div class="retro-stat-box">
									<span class="retro-label">Contact:</span>
									<a href="https://en.wikipedia.org/wiki/Trollface" target="_blank" class="retro-link">michaelward1916@ucla.edu</a>
								</div>
								<div class="retro-stat-box">
									<span class="retro-label">GitHub:</span>
									<a href="https://github.com/Mykol-Word" target="_blank" class="retro-link">https://github.com/Mykol-Word</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- About Section -->
			<div class="retro-panel mb-8">
				<div class="retro-title-bar">
					<span class="retro-title-text">About</span>
				</div>
				<div class="retro-content">
					<div class="retro-quest-item">
						<p class="retro-quest-text">
							I'm a third year undergraduate at UCLA studying Computer Science & Engineering and Philosophy. 
							I’m deeply interested in computer science as a whole but by necessity I've chosen to focus on only a few things, 
							namely, embedded systems, robotics, machine learning, and hardware–software integration. 
							In philosophy, I am interested in many areas as well, though my main focus is moral philosophy. <br><br>

							<i>If I had infinite time and resources, I would explore all niches of computer science and philosophy entirely and thoroughly.
							Since, I don't, I've chosen to emphasize my computer science degree and focus on only a few areas.</i> <br><br>

							My non-academic interests are weight-lifting, climbing, game development/modding, and playing video games. I'm pretty bad at all but the last one.
						</p>
					</div>
				</div>
			</div>

			<!-- Experience Section -->
			<div class="retro-panel mb-8">
				<div class="retro-title-bar">
					<span class="retro-title-text">Experience</span>
				</div>
				<div class="retro-content">
					<div class="space-y-4">
						{experienceData.map((experience, index) => (
							<div class="retro-quest-item">
								<div class="flex justify-between items-start mb-2">
									<div>
										<div class="flex items-center gap-3 flex-wrap">
											<h3 class="retro-quest-title">{experience.title}</h3>
											{experience.links && experience.links.length > 0 && (
												<div class="flex gap-2">
													{experience.links.map((link) => (
														<a href={link.url} target="_blank" class="retro-link text-sm">[{link.label}]</a>
													))}
												</div>
											)}
										</div>
										<p class="retro-employer-text">{experience.employer}</p>
									</div>
									<span class="retro-date-badge">{experience.date}</span>
								</div>
								<p class="retro-quest-text">
									{experience.description}
								</p>
							</div>
						))}
					</div>
				</div>
			</div>

			<!-- Projects Section -->
			<div class="retro-panel">
				<div class="retro-title-bar">
					<span class="retro-title-text">Projects</span>
				</div>
				<div class="retro-content">
					{projectsData.map((categoryGroup, groupIndex) => (
						<div class={groupIndex > 0 ? "mt-6" : ""}>
							<div class="retro-category-box">
								<div class="retro-category-header collapsible-header expanded" data-category={categoryGroup.category}>
									<span class="category-chevron">▶</span>
									{categoryGroup.category}
								</div>
								<div class="category-content expanded">
									<div class="space-y-4">
										{categoryGroup.projects.map((project) => (
											<div class="retro-quest-item">
												<div class="flex justify-between items-start mb-2">
													<div class="flex items-center gap-3 flex-wrap">
														<h3 class="retro-quest-title">{project.title}</h3>
														{project.links && project.links.length > 0 && (
															<div class="flex gap-2">
																{project.links.map((link) => (
																	<a href={link.url} target="_blank" class="retro-link text-sm">[{link.label}]</a>
																))}
															</div>
														)}
													</div>
													<span class="retro-date-badge">{project.date}</span>
												</div>
												<p class="retro-quest-text">
													{project.description}
												</p>
											</div>
										))}
									</div>
								</div>
							</div>
						</div>
					))}
				</div>
			</div>
		</div>

		<style>
			/* RuneScape/Retro Panel Styles */
			.retro-panel {
				background: linear-gradient(135deg, #c9a961 0%, #a58a54 100%);
				border: 4px outset #d4af6a;
				box-shadow:
					0 8px 0 #5c4a2f,
					0 8px 16px rgba(0, 0, 0, 0.6),
					inset 0 2px 0 #e6d4a8;
			}

			.retro-title-bar {
				background: linear-gradient(180deg, #8b6f47 0%, #5c4a2f 100%);
				border: 2px solid #3d2f1f;
				border-bottom: 3px solid #2a1f14;
				padding: 8px 16px;
				margin: -4px -4px 0 -4px;
				box-shadow: inset 0 1px 0 #9d8359;
			}

			.retro-title-text {
				font-size: 1.5rem;
				font-weight: bold;
				color: #ffd700;
				text-shadow:
					2px 2px 0 #8b4513,
					-1px -1px 0 #000,
					1px -1px 0 #000,
					-1px 1px 0 #000,
					1px 1px 0 #000;
				font-family: 'Arial Black', sans-serif;
				letter-spacing: 1px;
			}

			.retro-content {
				padding: 20px;
				background: repeating-linear-gradient(
					0deg,
					rgba(255, 255, 255, 0.03) 0px,
					rgba(255, 255, 255, 0.03) 1px,
					transparent 1px,
					transparent 2px
				);
			}

			/* Profile Avatar */
			.retro-avatar {
				width: 140px;
				height: 140px;
				border: 5px ridge #8b6f47;
				background: linear-gradient(135deg, #654321 0%, #3d2817 100%);
				box-shadow:
					0 6px 0 #3d2f1f,
					0 6px 12px rgba(0, 0, 0, 0.8),
					inset 0 -3px 8px rgba(0, 0, 0, 0.5);
			}

			.retro-avatar-inner {
				width: 100%;
				height: 100%;
				display: flex;
				align-items: center;
				justify-content: center;
				background: linear-gradient(135deg, #ff6b35 0%, #f7931e 50%, #ffd700 100%);
				font-size: 3rem;
				font-weight: 900;
				color: white;
				text-shadow:
					3px 3px 0 rgba(0, 0, 0, 0.5),
					-1px -1px 0 rgba(0, 0, 0, 0.3);
				font-family: 'Impact', sans-serif;
				overflow: hidden;
			}

			.retro-avatar-inner img {
				width: 100%;
				height: 100%;
				object-fit: cover;
				object-position: center;
			}

			/* WordArt-style Name */
			.retro-wordart {
				font-size: 2.5rem;
				font-weight: 900;
				background: linear-gradient(45deg,
					#ff0000 0%,
					#ff7f00 14%,
					#ffff00 28%,
					#00ff00 42%,
					#0000ff 57%,
					#4b0082 71%,
					#9400d3 85%,
					#ff0000 100%
				);
				-webkit-background-clip: text;
				background-clip: text;
				-webkit-text-fill-color: transparent;
				filter: drop-shadow(3px 3px 0 rgba(0, 0, 0, 0.4));
				font-family: 'Impact', 'Arial Black', sans-serif;
				letter-spacing: 2px;
			}

			/* Stat Boxes */
			.retro-stat-box {
				background: linear-gradient(135deg, #8b7355 0%, #6b5845 100%);
				border: 3px groove #a58a54;
				padding: 8px 12px;
				box-shadow:
					inset 0 2px 4px rgba(0, 0, 0, 0.3),
					0 2px 0 rgba(255, 255, 255, 0.1);
			}

			.retro-label {
				font-weight: bold;
				color: #ffd700;
				text-shadow: 1px 1px 0 #000;
				font-family: 'Arial', sans-serif;
			}

			.retro-value {
				color: #ffffff;
				text-shadow: 1px 1px 0 #000;
				font-family: 'Arial', sans-serif;
			}

			.retro-link {
				color: #00ffff;
				text-shadow: 1px 1px 0 #000;
				text-decoration: underline;
				font-family: 'Arial', sans-serif;
				transition: color 0.2s;
			}

			.retro-link:hover {
				color: #ff00ff;
				text-decoration: underline wavy;
			}

			/* Quest Items */
			.retro-quest-item {
				background: linear-gradient(135deg, #8b7355 0%, #6b5845 100%);
				border: 4px ridge #a58a54;
				padding: 12px 16px;
				box-shadow:
					0 4px 0 #3d2f1f,
					0 4px 8px rgba(0, 0, 0, 0.6),
					inset 0 1px 0 #9d8359;
				transition: transform 0.2s, box-shadow 0.2s;
			}

			.retro-quest-item:hover {
				transform: translateY(-2px);
				box-shadow:
					0 6px 0 #3d2f1f,
					0 6px 12px rgba(0, 0, 0, 0.7),
					inset 0 1px 0 #9d8359;
			}

			.retro-quest-title {
				font-size: 1.25rem;
				font-weight: bold;
				color: #ffd700;
				text-shadow:
					2px 2px 0 #000,
					-1px -1px 0 #000;
				font-family: 'Arial Black', sans-serif;
			}

			.retro-date-badge {
				background: linear-gradient(180deg, #ff6b35 0%, #c7522a 100%);
				color: white;
				padding: 6px 12px;
				border: 3px outset #ff8c61;
				font-weight: bold;
				font-family: 'Arial', sans-serif;
				text-shadow: 1px 1px 0 #000;
				box-shadow:
					0 3px 0 #8b3a1f,
					0 3px 6px rgba(0, 0, 0, 0.5);
			}

			.retro-quest-text {
				color: #f0e6d2;
				font-family: 'Arial', sans-serif;
				text-shadow: 1px 1px 0 #000;
				line-height: 1.6;
			}

			.retro-employer-text {
				font-size: 0.875rem;
				font-weight: 600;
				color: rgb(250, 204, 21); /* text-yellow-400 */
				margin-top: 0.25rem;
			}

			/* Category Box Styles */
			.retro-category-box {
				background: linear-gradient(135deg, #7a6344 0%, #5d4a32 100%);
				border: 3px ridge #9d8359;
				padding: 16px;
				box-shadow:
					inset 0 1px 3px rgba(0, 0, 0, 0.4),
					0 2px 4px rgba(0, 0, 0, 0.3);
			}

			.retro-category-header {
				background: linear-gradient(180deg, #a58a54 0%, #8b6f47 100%);
				border: 2px solid #6b5845;
				padding: 8px 16px;
				margin: -16px -16px 16px -16px;
				font-size: 1.25rem;
				font-weight: bold;
				color: #ffd700;
				text-shadow: 2px 2px 0 #000;
				font-family: 'Arial Black', sans-serif;
				box-shadow:
					inset 0 1px 0 #c9a961,
					0 2px 0 #3d2f1f;
			}

			.collapsible-header {
				cursor: pointer;
				user-select: none;
				transition: background 0.2s;
				margin: -16px -16px 0 -16px !important;
			}

			.collapsible-header.expanded {
				margin: -16px -16px 16px -16px !important;
			}

			.collapsible-header:hover {
				background: linear-gradient(180deg, #b59a64 0%, #9b7f57 100%);
			}

			.collapsible-header:active {
				background: linear-gradient(180deg, #8b6f47 0%, #7a6344 100%);
			}

			.category-chevron {
				display: inline-block;
				margin-right: 8px;
				transition: transform 0.3s ease;
				font-size: 0.9rem;
			}

			.collapsible-header.expanded .category-chevron {
				transform: rotate(90deg);
			}

			.category-content {
				overflow: hidden;
				transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
				max-height: 0;
				opacity: 0;
			}

			.category-content.expanded {
				max-height: 5000px;
				opacity: 1;
				margin-top: 16px;
			}

			/* Minigame Styles */
			.retro-score {
				background: linear-gradient(135deg, #c9a961 0%, #a58a54 100%);
				border: 4px outset #d4af6a;
				padding: 12px 20px;
				font-size: 1.25rem;
				font-weight: bold;
				color: #ffd700;
				text-shadow: 2px 2px 0 #000;
				font-family: 'Arial Black', sans-serif;
				box-shadow:
					0 4px 0 #5c4a2f,
					0 4px 8px rgba(0, 0, 0, 0.6);
			}

			.retro-shop {
				display: flex;
				flex-direction: column;
				gap: 8px;
			}

			.shop-item {
				display: flex;
				gap: 4px;
			}

			.shop-button {
				background: linear-gradient(135deg, #c9a961 0%, #a58a54 100%);
				border: 3px outset #d4af6a;
				padding: 8px 12px;
				font-size: 0.9rem;
				font-weight: bold;
				color: #ffd700;
				text-shadow: 1px 1px 0 #000;
				font-family: 'Arial Black', sans-serif;
				box-shadow: 0 3px 0 #5c4a2f, 0 3px 6px rgba(0, 0, 0, 0.6);
				cursor: pointer;
				transition: all 0.1s;
				display: flex;
				flex-direction: column;
				align-items: center;
				gap: 4px;
			}

			.shop-button:hover {
				background: linear-gradient(135deg, #d4af6a 0%, #b59a64 100%);
			}

			.shop-button:active {
				transform: translateY(2px);
				box-shadow: 0 1px 0 #5c4a2f, 0 1px 3px rgba(0, 0, 0, 0.6);
			}

			.shop-button:disabled {
				opacity: 0.5;
				cursor: not-allowed;
			}

			.shop-button.purchased {
				background: linear-gradient(135deg, #6b8e23 0%, #556b2f 100%);
				border-color: #8fbc8f;
			}

			.shop-name {
				font-size: 0.85rem;
			}

			.shop-cost {
				font-size: 0.75rem;
				color: #ffed4e;
			}

			.toggle-button {
				background: linear-gradient(135deg, #4169e1 0%, #1e3a8a 100%);
				border: 3px outset #6495ed;
				padding: 8px 12px;
				font-size: 0.8rem;
				font-weight: bold;
				color: white;
				text-shadow: 1px 1px 0 #000;
				font-family: 'Arial Black', sans-serif;
				box-shadow: 0 3px 0 #0f1f47, 0 3px 6px rgba(0, 0, 0, 0.6);
				cursor: pointer;
				transition: all 0.1s;
			}

			.toggle-button:hover {
				background: linear-gradient(135deg, #5a7fef 0%, #2e4a9a 100%);
			}

			.toggle-button:active {
				transform: translateY(2px);
				box-shadow: 0 1px 0 #0f1f47, 0 1px 3px rgba(0, 0, 0, 0.6);
			}

			.toggle-button.active {
				background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
				border-color: #4ade80;
			}

			.game-coin {
				width: 30px;
				height: 30px;
				cursor: pointer;
			}

			.game-coin:hover {
				transform: scale(1.2);
			}

			@keyframes fadeOut {
				0% {
					opacity: 1;
					transform: scale(1);
				}
				100% {
					opacity: 0;
					transform: scale(0.3);
				}
			}

			@keyframes coinAppear {
				0% {
					opacity: 0;
					transform: scale(0);
				}
				50% {
					transform: scale(1.2);
				}
				100% {
					opacity: 1;
					transform: scale(1);
				}
			}

			@keyframes float {
				0%, 100% {
					transform: translateY(0px);
				}
				50% {
					transform: translateY(-20px);
				}
			}

			@keyframes spin {
				0% {
					transform: rotateY(0deg);
				}
				100% {
					transform: rotateY(360deg);
				}
			}

			@keyframes collect {
				0% {
					transform: scale(1);
					opacity: 1;
				}
				100% {
					transform: scale(2) translateY(-50px);
					opacity: 0;
				}
			}

			/* Container Scaling */
			.responsive-container {
				max-width: 896px; /* Default for 1920x1080 */
			}

			/* High Resolution Display Styles - 4K (3840x2160) */
			@media (min-width: 3840px) {
				.responsive-container {
					max-width: 1792px; /* 2x for 4K */
				}

				.retro-title-text {
					font-size: 3rem; /* 2x of 1.5rem */
				}

				.retro-wordart {
					font-size: 5rem; /* 2x of 2.5rem */
				}

				.retro-avatar {
					width: 280px; /* 2x of 140px */
					height: 280px;
				}

				.retro-avatar-inner {
					font-size: 6rem; /* 2x of 3rem */
				}

				.retro-quest-title {
					font-size: 2.5rem; /* 2x of 1.25rem */
				}

				.retro-date-badge {
					font-size: 1.6rem;
					padding: 12px 24px; /* 2x */
				}

				.retro-score {
					font-size: 2.5rem; /* 2x of 1.25rem */
					padding: 24px 40px; /* 2x of 12px 20px */
					top: 2rem;
					right: 2rem;
				}

				.retro-content {
					padding: 40px; /* 2x of 20px */
				}

				.retro-stat-box {
					padding: 16px 24px; /* 2x of 8px 12px */
				}

				.retro-label, .retro-value, .retro-link {
					font-size: 2rem; /* 2x */
				}

				.retro-quest-text {
					font-size: 2rem; /* 2x */
					line-height: 1.6;
				}

				.retro-category-header {
					font-size: 2.5rem; /* 2x of 1.25rem */
					padding: 16px 32px; /* 2x of 8px 16px */
				}

				.retro-employer-text {
					font-size: 1.75rem; /* 2x of 0.875rem */
					margin-top: 0.5rem; /* 2x of 0.25rem */
				}

				.retro-quest-item {
					padding: 24px 32px; /* 2x of 12px 16px */
				}

				.retro-panel {
					border-width: 8px; /* 2x of 4px */
				}

				.retro-title-bar {
					border-width: 4px; /* 2x of 2px */
					padding: 16px 32px; /* 2x of 8px 16px */
				}
			}

			/* 1440p (2560x1440) - Scale by 1.33x */
			@media (min-width: 2560px) and (max-width: 3839px) {
				.responsive-container {
					max-width: 1194px; /* 1.33x */
				}

				.retro-title-text {
					font-size: 2rem; /* 1.33x of 1.5rem */
				}

				.retro-wordart {
					font-size: 3.33rem; /* 1.33x of 2.5rem */
				}

				.retro-avatar {
					width: 186px; /* 1.33x of 140px */
					height: 186px;
				}

				.retro-avatar-inner {
					font-size: 4rem; /* 1.33x of 3rem */
				}

				.retro-quest-title {
					font-size: 1.66rem; /* 1.33x of 1.25rem */
				}

				.retro-date-badge {
					font-size: 1.1rem;
					padding: 8px 16px; /* 1.33x */
				}

				.retro-score {
					font-size: 1.66rem; /* 1.33x of 1.25rem */
					padding: 16px 27px; /* 1.33x of 12px 20px */
				}

				.retro-content {
					padding: 27px; /* 1.33x of 20px */
				}

				.retro-stat-box {
					padding: 11px 16px; /* 1.33x of 8px 12px */
				}

				.retro-label, .retro-value, .retro-link {
					font-size: 1.33rem; /* 1.33x */
				}

				.retro-quest-text {
					font-size: 1.33rem; /* 1.33x */
					line-height: 1.6;
				}

				.retro-category-header {
					font-size: 1.66rem; /* 1.33x of 1.25rem */
					padding: 11px 21px; /* 1.33x of 8px 16px */
				}

				.retro-employer-text {
					font-size: 1.16rem; /* 1.33x of 0.875rem */
					margin-top: 0.33rem; /* 1.33x of 0.25rem */
				}

				.retro-quest-item {
					padding: 16px 21px; /* 1.33x of 12px 16px */
				}
			}

			/* Mobile Responsive Styles */
			@media (max-width: 640px) {
				.retro-title-text {
					font-size: 1rem;
				}

				.retro-wordart {
					font-size: 1.5rem;
				}

				.retro-avatar {
					width: 80px;
					height: 80px;
				}

				.retro-avatar-inner {
					font-size: 1.5rem;
				}

				.retro-quest-title {
					font-size: 0.9rem;
				}

				.retro-date-badge {
					display: none;
				}

				.retro-score {
					display: none;
				}

				.retro-shop {
					display: none;
				}

				.retro-content {
					padding: 10px;
				}

				.retro-stat-box {
					padding: 5px 8px;
					font-size: 0.75rem;
				}

				.retro-label, .retro-value, .retro-link {
					font-size: 0.75rem;
				}

				.retro-quest-text {
					font-size: 0.75rem;
					line-height: 1.4;
				}

				.retro-category-header {
					font-size: 0.9rem;
					padding: 6px 10px;
				}

				.retro-employer-text {
					font-size: 0.75rem;
				}
			}
		</style>

		<script is:inline>
			// Category Collapsible Toggle
			document.addEventListener('DOMContentLoaded', () => {
				// Setup collapsible categories
				const categoryHeaders = document.querySelectorAll('.collapsible-header');

				categoryHeaders.forEach(header => {
					header.addEventListener('click', () => {
						const content = header.nextElementSibling;
						const isExpanded = header.classList.contains('expanded');

						if (isExpanded) {
							header.classList.remove('expanded');
							content.classList.remove('expanded');
						} else {
							header.classList.add('expanded');
							content.classList.add('expanded');
						}
					});
				});

				// Minigame Script
				// Disable minigame on mobile
				if (window.innerWidth <= 640) {
					return;
				}

				// Load saved data
				let score = parseInt(localStorage.getItem('coinScore') || '0');
				let purchases = JSON.parse(localStorage.getItem('purchases') || '{}');
				let toggleStates = JSON.parse(localStorage.getItem('toggleStates') || '{}');

				const scoreDisplay = document.getElementById('score');

				if (!scoreDisplay) {
					console.error('Score display not found');
					return;
				}

				// Initialize display
				scoreDisplay.textContent = score;

				// Shop elements
				const purpleBtn = document.getElementById('purple-btn');
				const purpleToggle = document.getElementById('purple-toggle');
				const evilBtn = document.getElementById('evil-btn');
				const evilToggle = document.getElementById('evil-toggle');
				const newCoinBtn = document.getElementById('newcoin-btn');
				const newCoinToggle = document.getElementById('newcoin-toggle');

				// Update score display
				function updateScore(newScore) {
					score = newScore;
					scoreDisplay.textContent = score;
					localStorage.setItem('coinScore', score.toString());
					updateShopButtons();
				}

				// Update shop button states
				function updateShopButtons() {
					// Purple background
					if (purchases.purple) {
						purpleBtn.textContent = 'Purchased';
						purpleBtn.classList.add('purchased');
						purpleBtn.disabled = true;
						purpleToggle.style.display = 'block';
					} else {
						purpleBtn.disabled = score < 15;
					}

					// Evil mode
					if (purchases.evil) {
						evilBtn.textContent = 'Purchased';
						evilBtn.classList.add('purchased');
						evilBtn.disabled = true;
						evilToggle.style.display = 'block';
					} else {
						evilBtn.disabled = score < 40;
					}

					// New coin
					if (purchases.newCoin) {
						newCoinBtn.textContent = 'Purchased';
						newCoinBtn.classList.add('purchased');
						newCoinBtn.disabled = true;
						newCoinToggle.style.display = 'block';
					} else {
						newCoinBtn.disabled = score < 50;
					}
				}

				// Apply purple background
				function applyPurple(enabled) {
					const body = document.body;
					if (enabled) {
						body.style.background = 'repeating-linear-gradient(45deg, #4a1d4a, #4a1d4a 10px, #6b2d6b 10px, #6b2d6b 20px)';
						purpleToggle.classList.add('active');
					} else {
						body.style.background = 'repeating-linear-gradient(45deg, #2d5016, #2d5016 10px, #3a6b1e 10px, #3a6b1e 20px)';
						purpleToggle.classList.remove('active');
					}
				}

				// Apply evil mode
				function applyEvil(enabled) {
					const pfp = document.querySelector('.retro-avatar-inner img');
					const body = document.body;
					const panels = document.querySelectorAll('.retro-panel, .retro-category-box, .retro-score, .retro-shop');
					const yellowTexts = document.querySelectorAll('.retro-title-text, .retro-quest-title, .retro-category-header, #score, .shop-button');
					const brownElements = document.querySelectorAll('.retro-panel, .retro-category-box, .retro-category-header, .retro-score, .shop-button');
					const nameElement = document.querySelector('.retro-wordart');

					if (enabled) {
						if (pfp) {
							pfp.style.transform = 'rotate(180deg) scaleX(-1)';
							pfp.style.filter = 'invert(1)';
						}
						body.style.background = 'repeating-linear-gradient(45deg, #2d0a0a, #2d0a0a 10px, #4a1515 10px, #4a1515 20px)';

						// Change name to evil version
						if (nameElement) {
							nameElement.textContent = 'Wichael Mard';
						}

						// Change yellow to red
						yellowTexts.forEach(el => {
							el.style.color = '#ff4444';
						});

						// Change brown backgrounds to orange
						brownElements.forEach(el => {
							if (el.classList.contains('retro-panel') || el.classList.contains('retro-category-box')) {
								el.style.background = 'linear-gradient(135deg, #d4691e 0%, #b35a1a 100%)';
							} else if (el.classList.contains('retro-category-header')) {
								el.style.background = 'linear-gradient(180deg, #d4691e 0%, #b35a1a 100%)';
							} else if (el.classList.contains('retro-score') || el.classList.contains('shop-button')) {
								el.style.background = 'linear-gradient(135deg, #d4691e 0%, #b35a1a 100%)';
							}
						});

						evilToggle.classList.add('active');
					} else {
						if (pfp) {
							pfp.style.transform = '';
							pfp.style.filter = '';
						}

						// Reset name
						if (nameElement) {
							nameElement.textContent = 'Michael Ward';
						}

						// Reset colors
						yellowTexts.forEach(el => {
							el.style.color = '';
						});
						brownElements.forEach(el => {
							el.style.background = '';
						});

						// Apply purple if it's enabled
						if (toggleStates.purple) {
							applyPurple(true);
						} else {
							body.style.background = 'repeating-linear-gradient(45deg, #2d5016, #2d5016 10px, #3a6b1e 10px, #3a6b1e 20px)';
						}

						evilToggle.classList.remove('active');
					}
				}

				// Purchase handlers
				purpleBtn.addEventListener('click', () => {
					if (score >= 15 && !purchases.purple) {
						updateScore(score - 15);
						purchases.purple = true;
						localStorage.setItem('purchases', JSON.stringify(purchases));
						toggleStates.purple = true;
						localStorage.setItem('toggleStates', JSON.stringify(toggleStates));
						updateShopButtons();

						// Only apply if evil mode is not active
						if (!toggleStates.evil) {
							applyPurple(true);
						}
					}
				});

				evilBtn.addEventListener('click', () => {
					if (score >= 40 && !purchases.evil) {
						updateScore(score - 40);
						purchases.evil = true;
						localStorage.setItem('purchases', JSON.stringify(purchases));
						toggleStates.evil = true;
						localStorage.setItem('toggleStates', JSON.stringify(toggleStates));
						updateShopButtons();

						// Evil always applies (overrides purple)
						applyEvil(true);
					}
				});

				newCoinBtn.addEventListener('click', () => {
					if (score >= 50 && !purchases.newCoin) {
						updateScore(score - 50);
						purchases.newCoin = true;
						localStorage.setItem('purchases', JSON.stringify(purchases));
						toggleStates.newCoin = true;
						localStorage.setItem('toggleStates', JSON.stringify(toggleStates));
						updateShopButtons();

						// Update toggle state
						if (toggleStates.newCoin) {
							newCoinToggle.classList.add('active');
						}
					}
				});

				// Toggle handlers
				purpleToggle.addEventListener('click', () => {
					toggleStates.purple = !toggleStates.purple;
					localStorage.setItem('toggleStates', JSON.stringify(toggleStates));

					// Evil mode takes precedence - only apply purple if evil is off
					if (!toggleStates.evil) {
						applyPurple(toggleStates.purple);
					}
					// Update toggle button state even when evil is active
					if (toggleStates.purple) {
						purpleToggle.classList.add('active');
					} else {
						purpleToggle.classList.remove('active');
					}
				});

				evilToggle.addEventListener('click', () => {
					toggleStates.evil = !toggleStates.evil;
					localStorage.setItem('toggleStates', JSON.stringify(toggleStates));

					// Evil mode overrides purple
					applyEvil(toggleStates.evil);
				});

				newCoinToggle.addEventListener('click', () => {
					toggleStates.newCoin = !toggleStates.newCoin;
					localStorage.setItem('toggleStates', JSON.stringify(toggleStates));

					// Update toggle button state
					if (toggleStates.newCoin) {
						newCoinToggle.classList.add('active');
					} else {
						newCoinToggle.classList.remove('active');
					}
				});

				// Initialize shop and apply saved states
				updateShopButtons();

				// Apply modes - evil takes precedence
				if (toggleStates.evil) {
					applyEvil(true);
				} else if (toggleStates.purple) {
					applyPurple(true);
				}

				// Apply new coin toggle state
				if (toggleStates.newCoin) {
					newCoinToggle.classList.add('active');
				}

				function createCoin() {
					const coin = document.createElement('div');
					coin.className = 'game-coin';

					// Add image element
					const img = document.createElement('img');
					const baseUrl = window.BASE_URL.endsWith('/') ? window.BASE_URL : window.BASE_URL + '/';

					// Use troll.png if newCoin is toggled, otherwise use coin.png
					const coinImage = toggleStates.newCoin ? 'troll.png' : 'coin.png';
					img.src = baseUrl + 'images/' + coinImage;
					img.style.width = '50px';
					img.style.height = '50px';
					img.style.display = 'block';
					coin.appendChild(img);

					// Random position - avoid center content area
					const centerStart = (window.innerWidth - 896) / 2; // max-w-4xl is ~896px
					const centerEnd = centerStart + 1000;
					let x;

					// Spawn only on sides (not over main content)
					if (Math.random() < 0.5) {
						// Left side
						x = Math.random() * Math.max(0, centerStart - 50);
					} else {
						// Right side
						x = centerEnd + (Math.random() * Math.max(0, window.innerWidth - centerEnd - 50));
					}

					const y = Math.random() * (window.innerHeight - 50);

					// Set all positioning inline
					coin.style.position = 'fixed';
					coin.style.left = x + 'px';
					coin.style.top = y + 'px';
					coin.style.zIndex = '40';
					coin.style.opacity = '0';
					coin.style.animation = 'coinAppear 1.75s ease-out forwards';
					coin.style.animationDelay = Math.random() * 2 + 's';

					// Mouseover handler
					coin.addEventListener('mouseover', () => {
						updateScore(score + 1);

						// Collect animation
						coin.style.animation = 'collect 0.5s ease-out forwards';
						setTimeout(() => {
							coin.remove();
						}, 500);
					});

					document.body.appendChild(coin);

					// Auto-remove after 8 seconds with fade animation
					setTimeout(() => {
						if (coin.parentElement) {
							coin.style.animation = 'fadeOut 0.8s ease-out forwards';
							setTimeout(() => coin.remove(), 800);
						}
					}, 8000);
				}

				// Spawn coins periodically
				setInterval(createCoin, 750);

				// Initial coins
				setTimeout(createCoin, 500);
				setTimeout(createCoin, 1000);
			});
		</script>
	</body>
</html>
